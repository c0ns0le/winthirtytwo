{
  "name": "winthirtytwo",
  "tagline": "Repository for windows implementation.",
  "body": "NOTE: for ballerz yo.\r\n\r\n## [00] INSTALL\r\n### Install service bus locally.\r\n* [Installing and Configuring Service Bus for Windows Server] (https://msdn.microsoft.com/en-us/library/azure/jj193014(v=azure.10).aspx)\r\n* click [here] (http://go.microsoft.com/fwlink/?LinkID=252361).\r\n```css\r\n# Run in Service Bus PowerShell Console\r\n\r\n# Create new SB Farm\r\n$SBCertificateAutoGenerationKey = ConvertTo-SecureString -AsPlainText -Force -String \"A strong auto generation key\"\r\n\r\nNew-SBFarm -SBFarmDBConnectionString 'Data Source=localhost;Initial Catalog=SbManagementDB;Integrated Security=True' -InternalPortRangeStart 9000 -HttpsPort 9355 -TcpPort 9354 -MessageBrokerPort 9356 -RunAsName 'userName@domain' -AdminGroup 'BUILTIN\\Administrators' -GatewayDBConnectionString 'Data Source=localhost;Initial Catalog=SbGatewayDatabase;Integrated Security=True' -CertificateAutoGenerationKey $SBCertificateAutoGenerationKey -MessageContainerDBConnectionString 'Data Source=localhost;Initial Catalog=ServiceBusDefaultContainer;Integrated Security=True';\r\n\r\n\r\n# Add SB Host\r\n$SBRunAsPassword = ConvertTo-SecureString -AsPlainText -Force -String ***** Replace with RunAs Password for Service Bus in single quote ******;\r\n\r\nAdd-SBHost -SBFarmDBConnectionString 'Data Source=localhost;Initial Catalog=SbManagementDB;Integrated Security=True' -RunAsPassword $SBRunAsPassword -EnableFirewallRules $true -CertificateAutoGenerationKey $SBCertificateAutoGenerationKey;\r\n\r\n# Create new SB Namespace\r\nNew-SBNamespace -Name 'ServiceBusDefaultNamespace' -AddressingScheme 'Path' -ManageUsers 'userName@domain';\r\n\r\n# Get SB Client Configuration\r\n$SBClientConfiguration = Get-SBClientConfiguration -Namespaces 'ServiceBusDefaultNamespace';\r\n\r\n```\r\n### install Azure CLI from [here] (http://aka.ms/webpi-azure-cli)\r\n\r\n### install Azure Powershell [here] (http://aka.ms/webpi-azps)\r\n\r\n```css\r\n# Install the Azure Resource Manager modules from the PowerShell Gallery\r\nInstall-Module AzureRM\r\n\r\n# Install the Azure Service Management module from the PowerShell Gallery\r\nInstall-Module Azure\r\n\r\n# To make sure the Azure PowerShell module is available after you install\r\nGet-Module –ListAvailable \r\n\r\n# To login to Azure Resource Manager\r\nLogin-AzureRmAccount\r\n\r\n# You can also use a specific Tenant if you would like a faster login experience\r\n# Login-AzureRmAccount -TenantId xxxx\r\n\r\n# To view all subscriptions for your account\r\nGet-AzureRmSubscription\r\n\r\n# To select a default subscription for your current session\r\nGet-AzureRmSubscription –SubscriptionName “your sub” | Select-AzureRmSubscription\r\n\r\n# View your current Azure PowerShell session context\r\n# This session state is only applicable to the current session and will not affect other sessions\r\nGet-AzureRmContext\r\n\r\n# To select the default storage context for your current session\r\nSet-AzureRmCurrentStorageAccount –ResourceGroupName “your resource group” –StorageAccountName “your storage account name”\r\n\r\n# View your current Azure PowerShell session context\r\n# Note: the CurrentStorageAccount is now set in your session context\r\nGet-AzureRmContext\r\n\r\n# To list all of the blobs in all of your containers in all of your accounts\r\nGet-AzureRmStorageAccount | Get-AzureStorageContainer | Get-AzureStorageBlob\r\n```\r\n## [01] SETUP\r\n\r\n### configure office365.\r\n* start [here] (https://support.office.com/en-us/article/Add-users-and-domain-to-Office-365-6383f56d-3d09-4dcb-9b41-b5f5a5efd611?CorrelationId=f96b8eb8-166b-4be2-90eb-e9138b03c1f5&ui=en-US&rs=en-US&ad=US)\r\n* do this:\r\n```css\r\n$dom = \"<domain.name>\"\r\n\r\nset-msoldomain -name $dom -IsDefault\r\nset-MsolDomainAuthentication -Authentication Managed -DomainName $dom\r\n\r\n#The following commands convert the existing domain to use single sign-on. Notice the certificate is in Base-64 encoding:\r\nconvert-MsolDomainToFederated\r\n\r\n$brand = \"brand Ltd.\"\r\n$ActiveSO = \"https://adfs.$dom/adfs/services/trust/2005/usernamemixed\"\r\n$PLUri$ = \"https://adfs.$dom/adfs/ls\"\r\n$IssuerUri = \"https://adfs.$dom/adfs/services/trust\"\r\n$cert = \"MIIEQzCCAyugAwIBAgIKYQm1CwAAAAAAEDANBgkqhkiG9w0BAQUFADBIMRMwEQYK\r\nCZImiZPyLGQBGRYDY29tMR0wGwYKCZImiZPyLGQBGRYNd29vZGdyb3ZlYmFuazES\r\nMBAGA1UEAxMJRGVudmVyLUNBMB4XDTEwMDExMDA2NDEwMFoXDTExMTExMTAxMTM0\r\nMFowIzEhMB8GA1UEAxMYZGVudmVyLndvb2Rncm92ZWJhbmsuY29tMIIBIjANBgkq\r\nhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEApUaiuxFkfXf9O5kUSpxOBSBFhjFirBb3\r\nddcs2weW/4cMniVNYGanLABVuqltfRHqWz6WZF/98VbqfCaETBaKu/QggcuhMoBc\r\nyT7E4n35GOFxf8OVUy38VI1BrFon/crs8IUc0pK3qKG0n4rsCRwnpxoEPar0MiSP\r\nr8jpDZa/eLcMV/1lFifpNXz2v1wKWYRKXrvg1sLJyABSRoAZShxaMcXehS0egmiP\r\ngYNhvZln2Z/M2Xwy5oh21lAjzbrW2eLmsqr1OTsFO497CBsuoWS4KQUbxf7hVj3T\r\ntgPXTphJsg6+2606nlJqflsxjpH90ucendRZVPJ1Vs83yMUcPUyA+QIDAQABo4IB\r\nUjCCAU4wDgYDVR0PAQH/BAQDAgWgMD0GCSsGAQQBgjcVBwQwMC4GJisGAQQBgjcV\r\nCIP16AeH74RRh62DOIaW7CWEl7BNJ4bS92uFwqxxAgFkAgECMB0GA1UdDgQWBBQ6\r\nRGMSiX+JPfV4zEGxeXGeFXm1kzAfBgNVHSMEGDAWgBSZzCX7ueHUBH7PY6wVldwn\r\nN/ntwjA/BgNVHR8EODA2MDSgMqAwhi5odHRwOi8vcGtpLndvb2Rncm92ZWJhbmsu\r\nY29tL0NEUC9EZW52ZXItQ0EuY3JsMEoGCCsGAQUFBwEBBD4wPDA6BggrBgEFBQcw\r\nAoYuaHR0cDovL3BraS53b29kZ3JvdmViYW5rLmNvbS9BSUEvRGVudmVyLUNBLmNy\r\ndDATBgNVHSUEDDAKBggrBgEFBQcDATAbBgkrBgEEAYI3FQoEDjAMMAoGCCsGAQUF\r\nBwMBMA0GCSqGSIb3DQEBBQUAA4IBAQCVaxdQ2nO5cpo0AQL+Pk/hXs3JOe+cRD1F\r\nq4QZzAtef7viv4By6RI4xvbjap5iRs3wzWBuRdTT4zKcTZrUkBuyo3rxkmy8dzbh\r\n0nXFrIS6onvPQDAxXLgz8b/YnlfnpCH1t/FoH6lqjmsiESYtfj43j8epDg91OhvQ\r\nhirX2Q+27LBEvf9pmG/Nc7WXlm38UI1tpHw9lYqEOde2bxz7o2hgLcZg8ptJx4ci\r\nPnB9VyrfTjPutLI4GqSuaMqrYxzjVplNkVMV3ZjJc2Jh8mLiaY7iPwRO3zPMs+Vn\r\nhb32hqVF14uxWC4DNO5ccaqTKxUKH0LngEo9GItFhjxGlcg0fwI0\"\r\nSet-MsolDomainAuthentication –DomainName $dom -FederationBrandName $brand -Authentication Federated -PassiveLogOnUri $PLUri -SigningCertificate $cert -IssuerUri $IssuerUri -ActiveLogOnUri $ActiveSO -LogOffUri $PLUri\r\n\r\nSet-MsolPasswordPolicy DomainName $dom -NotificationDays 14 -ValidityPeriod 60 \r\n```\r\n### Link domain to office365.\r\n```css\r\nSynchronizeUpnForManagedUsers-Enable $True\r\n```\r\n### Setup azure with on premises domain.\r\n```css\r\n$cred=Get-Credential\r\nConnect-MsolService -Credential $cred\r\nLogin-AzureRmAccount -Credential $cred\r\nRegister-AzureADConnectHealthADDSAgent -Credentials $cred\r\nGet-MsolFederationProperty -DomainName $dom | FL Source, TokenSigningCertificate\r\nUpdate-MsolFederatedDomain\r\nGet-ADFSCertificate –CertificateType token-signing\r\nUpdate-ADFSCertificate –CertificateType token-signing\r\nSet-MSOLAdfscontext -Computer <ADFS server>\r\nUpdate-MSOLFederatedDomain –DomainName $dom\r\nMSOLFederatedDomain -DomainName $dom -SupportMultipleDomain\r\nNew-MsolFederatedDomain –SupportMultipleDomain –DomainName $dom\r\n```\r\n### Support subdomains.\r\n* Open AD FS Management\r\n* Right click the Microsoft Online RP trust and choose Edit Claim rules\r\n* Select the third claim rule, and replace with:\r\n```css\r\nc:[Type == \"http://schemas.xmlsoap.org/claims/UPN\"] => issue(Type = \"http://schemas.microsoft.com/ws/2008/06/identity/claims/issuerid\", Value = regexreplace(c.Value, \"^((.*)([.|@]))?(?<domain>[^.]*[.].*)$\", \"http://${domain}/adfs/services/trust/\"));\r\n```",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}